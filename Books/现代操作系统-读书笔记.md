#操作系统 #读书笔记 
# 第1章 概述
## 1 什么是操作系统
狭义上来讲，操作系统就是由内核和Shell组成
而广义上来讲，操作系统内核和操作系统框架
## 2 操作系统的职责
操作系统主要有两个职责：
* 对硬件进行管理和抽象
* 对应用提供服务并进行管理

所谓的对硬件进行管理和抽象，比如说我们的物理内存往往是有多条，而操作系统就负责将它们整合起来并提供一个虚拟的内存空间给用户使用；诸如此类的还有像硬盘，鼠标，键盘等外部设备，它们的种类往往是很多样的，而操作系统则对它们进行抽象，让用户可以忽略它们之间不同的差异
而所谓的对应用提供服务，也很好理解；比如我们需要使用网络通讯，那显然我们不可能手动把数据发到网卡再传输到网络，而是调用操作系统提供的SocketAPI来进行调用
# 第2章 硬件结构
## 1 冯诺依曼结构
现代计算机依然采用冯诺依曼结构，而该结构主要由三部分组成：
* CPU：用来进行计算
* 存储器：用来存放数据，CPU寄存器，CPU缓存，内存都属于存储器
* IO：负责与外界交互，如键盘、显示器、网卡等

## 2 指令集
要知道，我们写的代码本质上会被转为为一条条的指令交给CPU去执行，而不同CUP架构它提供的指令也是有所区别的
比如基于ARM架构的精简指令集和基于X86架构的复杂指令集，它们能提供的指令结构和数量都不一样
### 2.1 特权级
而为了操作系统的安全和隔离，操作系统提供了不同的特权级：
* 用户态：应用程序通常运行在该特权级，因此它能执行的指令是受限的
* 内核态：操作系统会运行在该特权级，可以执行所有的指令，能对底层硬件进行访问和控制

```ad-note
书中是以AArch64来举例，还包括了另外两种权限更高的特权级
```
### 2.2 特权级切换
有时候，我们的应用层序需要访问底层硬件，那么此时就需要进行特权级的切换，而操作系统一般提供了三种方法来进行：
* 系统调用：比如当进行网络通讯时，由于涉及协议栈的调用，而这些都是在内核态执行的，因此需要进行一次**svc(supervisor call)**，从用户态切换到内核态执行
* 异常：比如应用程序在执行期间，触发了某种异常，如缺页异常，而这种异常需要操作系统去处理，那么就会切换到内核态，然后操作系统从**异常向量表**中找到对应的处理函数
* 中断：最典型的就是我们的外设，比如我们给Linux中输入了命令，此时会触发中断，操作系统会找到相应的中断程序来处理

```ad-note
* 中断和异常是不同的，最明显的区别是，异常是应用程序主动产生的，而中断则是外部产生的
* 但是中断和异常都会涉及到特权级的切换，它们都是由CPU和操作系统协作来完成的，简单来说就是，由CPU去保存当前的状态，然后由操作系统来处理中断或者异常
```
## 3 CPU缓存
尽管我们的内存速度很快，但相比起CPU的运算速度来说还是太慢了，因此CPU内部也有CPU的缓存，当应用程序需要访问内存时，会先看CPU缓存能否命中，否则再去访问内存
```ad-question
CPU缓存容量这么低，主要缓存的是什么数据？指令还是数据？
```
